import { Canvas, Meta, Source } from "@storybook/blocks";
import * as RelayStories from "./Relay.stories.tsx";

<Meta of={RelayStories} />

# Relay Demo

The `Relay/App` and `Relay/AppWithDefer` stories provide two examples of a MSW handler generated by this library resolving a request originating from a Relay app.

## `App` query

In `App`, a single JSON response is generated using the mock resolver found in [`src/__tests__/mocks/handlers.ts`](https://github.com/apollographql/graphql-testing-library/blob/main/src/__tests__/mocks/handlers.ts).

<Source
  language="graphql"
  code={`
query RelayComponentWithDeferAppQuery {
  products {
    id
    ...RelayComponentReviewsFragment_product
    title
    mediaUrl
    description
  }
}
`}
/>

## `AppWithDefer` query

In `AppWithDefer`, the same mock resolver is used to generate the response, but the presence of `@defer` prompts the generated MSW handler to reply with a multipart response using the proposed [incremental delivery over HTTP](https://github.com/graphql/graphql-over-http/blob/main/rfcs/IncrementalDelivery.md) specification. While the `RelayComponentReviewsFragment_product` fragment is suspending, the `Reviews` component displays a `-` fallback.

View the response in the browser devtools network tab to inspect the multipart response after the final chunk has arrived.

<Source
  language="graphql"
  code={`
query RelayComponentWithDeferAppQuery {
  products {
    id
    ...RelayComponentReviewsFragment_product @defer
    title
    mediaUrl
    description
  }
}
`}
/>
